SET LINES 160 PAGES 5000 TIMING ON;

SELECT /*+PARALLEL(8)*/ SID, SERIAL#, OPNAME, ROUND(TIME_REMAINING/60, 2)TIME_MINUTE FROM V$SESSION_LONGOPS
WHERE SID IN(SELECT SID FROM V$SESSION WHERE UPPER(PROGRAM) LIKE '%RMAN%' AND STATUS='ACTIVE') AND TIME_REMAINING > 0;

SELECT SID, SERIAL#, EVENT, SECONDS_IN_WAIT FROM V$SESSION WHERE SID IN (SELECT SID FROM V$SESSION WHERE UPPER(PROGRAM) LIKE '%RMAN%');

SELECT SID, START_TIME, TOTALWORK SOFAR, ROUND((SOFAR/TOTALWORK) * 100,2) PCT_DONE
FROM V$SESSION_LONGOPS
WHERE TOTALWORK > SOFAR AND UPPER(OPNAME) NOT LIKE '%AGGREGATE%' AND UPPER(OPNAME) LIKE 'RMAN%';

COL CLIENT_INFO FORMAT A40;
COL EVENT FORMAT A40;
SELECT SID, SPID, CLIENT_INFO, EVENT, SECONDS_IN_WAIT, P1, P2, P3 FROM V$PROCESS P, V$SESSION S WHERE P.ADDR = S.PADDR AND UPPER(CLIENT_INFO) LIKE 'RMAN CHANNEL=%';

COL SIDSERIAL FOR A20;
SELECT SID||','||SERIAL# sidserial, CONTEXT, SOFAR, TOTALWORK, ROUND(SOFAR/TOTALWORK*100,2) "%_COMPLETE", START_TIME
FROM V$SESSION_LONGOPS
WHERE UPPER(OPNAME) LIKE 'RMAN%' AND UPPER(OPNAME) NOT LIKE '%AGGREGATE%' AND TOTALWORK != 0 AND SOFAR <> TOTALWORK
ORDER BY 6 DESC;

---
COL SIDSERIAL FOR A11;
SELECT SID||','||SERIAL# SIDSERIAL, CONTEXT, SOFAR, TOTALWORK, ROUND(SOFAR/TOTALWORK*100,2) "%_COMPLETE", START_TIME
FROM V$SESSION_LONGOPS
WHERE /*UPPER(OPNAME) LIKE 'RMAN%' AND */UPPER(OPNAME) NOT LIKE '%AGGREGATE%' AND TOTALWORK != 0 AND SOFAR <> TOTALWORK
ORDER BY 6 DESC;

COL SIDSERIAL FOR A11;
COL OPNAME FOR A35;
COL START_TIME FOR A20;
SELECT /*+PARALLEL(4)*/ INST_ID,SID||','||SERIAL# SIDSERIAL, SQL_ID, OPNAME, ROUND(TIME_REMAINING/60, 2)TIME_MINUTE, ROUND(SOFAR/TOTALWORK*100,2) "%_COMPLETE", to_char(START_TIME, 'DD-Mon-RR HH24:MI:SS')START_TIME
FROM GV$SESSION_LONGOPS WHERE SID IN(SELECT SID FROM GV$SESSION WHERE STATUS='ACTIVE') AND TIME_REMAINING > 0 ORDER BY START_TIME;

--Complete with hour and day remaining
COL SIDSERIAL FOR A11;
COL OPNAME FOR A35;
COL START_TIME FOR A20;
SELECT /*+PARALLEL(4)*/ INST_ID,SID||','||SERIAL# SIDSERIAL,
SQL_ID, OPNAME, ROUND(TIME_REMAINING/60, 2)MINUTE_REMAINING, ROUND(TIME_REMAINING/60/60, 2)HOUR_REMAINING, ROUND(TIME_REMAINING/60/60/24, 2)DAY_REMAINING, ROUND(SOFAR/TOTALWORK*100,2) "%_COMPLETE", TO_CHAR(START_TIME, 'DD-Mon-RR HH24:MI:SS')START_TIME
FROM GV$SESSION_LONGOPS WHERE SID IN(SELECT SID FROM GV$SESSION WHERE STATUS='ACTIVE') AND TIME_REMAINING > 0 ORDER BY START_TIME;